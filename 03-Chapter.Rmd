---
title: "itns Chapter 03"
author: "Peter Baumgartner"
date: "`r Sys.Date()`"
output:
  html_notebook:
    fig_caption: yes
    number_sections: yes
    pandoc_args: --number-offset=0,0
    toc: yes
    toc_depth: 6
  word_document:
    toc: yes
    toc_depth: '6'
  pdf_document:
    pandoc_args: --number-offset=0,0
    toc: yes
    toc_depth: '6'
    latex_engine: xelatex
  github_document:
    toc: yes
    toc_depth: 6
  html_document:
    fig_caption: yes
    keep_md: yes
    number_sections: yes
    pandoc_args: --number-offset=0,0
    toc: yes
    toc_depth: 6
---

# Setup
## Global options

```{r label = "global-options", highlight=TRUE}

### setting up working environment
### for details see: https://yihui.name/knitr/options/
knitr::opts_chunk$set(
        echo = T,
        message = T,
        error = T,
        warning = T,
        comment = '##',
        highlight = T,
        prompt = T,
        strip.white = T,
        tidy = T
        )

```

## Installing and loading R packages


```{r installing-and-loading-R-packages}

### https://www.tidyverse.org/
if (!require("tidyverse"))
        {install.packages("tidyverse", repos = 'http://cran.wu.ac.at/')
        library(tidyverse)}

### above command installed and loaded the core tidyverse packages:
# ggplot2: data visualisation
# tibble:  a modern take on data frames
# tidyr:   data tidying
# readr:   data import (csv, tsv, fwf)
# purrr:   functional R programming
# dplyr:   data (frame) manipulation
# stringr: string manipulation
# forcats: working with categorial varialbes


### to calculate mode:
if (!require("modeest"))
        {install.packages("modeest", repos = 'http://cran.wu.ac.at/')
        library(modeest)}

# I am going to use the `janitor` package for calculating table totals
if (!require("janitor"))
        {install.packages("janitor", repos = 'http://cran.wu.ac.at/')
        library(janitor)}

# For printing and building complex tables
# if (!require("knitr"))
#         {install.packages("knitr", repos = 'http://cran.wu.ac.at/')
#         library(knitr)}
# if (!require("kableExtra"))
#         {install.packages("kableExtra", repos = 'http://cran.wu.ac.at/')
#         library(kableExtra)}
```



# End-of-Chapter Exercises

## Calculating decriptive statistics

### Description

The folllowing table contains a set of ACT scores from a sample of college students. The ACT ist a standarized college-readiness exa taken by many U.S. students; scores can range fro 1 to 36.


Student | ACT  | $(X~i~ - M)$ | $(X~i~ - M)^2$
--------| ---- | ---------- | -------------
 1 | 26 |
 2 | 24 |
 3 | 28 |
 4 | 31 |
 5 | 20 |
 6 | 27 |
 7 | 18 |
 8 | 17 |
 9 | 21 |
10 | 29 |
11 | 24 |
Total | 

a. **Location:** Calculate the mean (_M_), median, and mode for this sample.
b. **Spread:** Calculate the standard deviation (_s_), range and interquartile range for this sample. For _s_, fill in the two columns on the right in the table above, then use the formular to calcualte _s_ yourself.


### Solution

```{r laod-data-into-vector}
ACT <- c(26, 24, 28, 31, 20, 27, 18, 17, 21, 29, 24)
```

Mean, median, standard deviation, range and interquartile range are easy as there exist special R commands. To calculate the mode we need _modest_, a package for mode estimation.

In R there are for the same task often several solution possible. I will add some of them.

Parameter   | Command in R           | Value  | 
------------|------------------------|-------:|
Mean _M_    | `round(mean(ACT),2)`   | `r round(mean(ACT),2)` 
Median (V1) | `median(ACT)`          | `r median(ACT)`
Median (V2) | `fivenum(ACT)[3]`      | `r fivenum(ACT)[3]`
Mode        | `mfv(ACT)`             | `r mfv(ACT)`
Variance    | `round(var(ACT),2)`    | `r round(var(ACT),2)`
 _s_        | `round(sd(ACT),2)`     | `r round(sd(ACT),2)`
Range (V1)  | `range(ACT)`           | `r range(ACT)`
Range (V2)  | `fivenum(ACT)[c(1,5)]` | `r fivenum(ACT)[c(1,5)]`
IQR         | `IQR(ACT)`             | `r IQR(ACT)`
Q1,Q3       | `fivenum(ACT)[c(2,4)]` | `r fivenum(ACT)[c(2,4)]`


To populate the table programmatically I will convert ACT to a data frame `ACT_df = as.data.frame(ACT)` resp. in a `tibble` as [tibbles has some advantages over data frames](https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html). The `tibble` package is part of the `tidyverse`.

```{r convert-vector-to-tibble}
### Calling `as_tibble()` on a vector is discouraged, because the behavior is likely to change in the future.
### I am using instead the `enframe` command
ACT_df <- enframe(ACT, name = "Student", value = "ACT")
```

```{r generate-columns-with-package-dplyr}

## using the pipe operator (https://magrittr.tidyverse.org/)
ACT_df <- ACT_df %>% mutate( # dplyr package; included in tidyverse
    `Xi-M` = round(ACT_df$ACT - mean(ACT_df$ACT),2),
    # `(Xi-M)^2` = round(((ACT_df$ACT - mean(ACT_df$ACT))^2),2)
    `(Xi-M)^2` = round(`Xi-M`^2,2)
    )

# ### now preparing the table with a similar design as in the book p.505
# ### not sure if this complex procedure is necessary 
# ### as the genuine R procedures are different than the manual table calculation

## sort by ACT score
ACT_df <- ACT_df[order(ACT_df$ACT), ]

ACT_df <- ACT_df %>%
    adorn_totals("row") # janitor package
ACT_df[12, 3] <- "   " # summing up Xi-M does not make sense
ACT_df[6,2] <- "<strong>24</strong>" # makes median bold
ACT_row1 <- c("Denominator", 11, "  ", 10)
ACT_row2 <- c("<em>M</em>", 24.09, " ", " ")
ACT_row3 <- c("<em>s</em>", "  ", " ", 21.29)
ACT_row4 <- c("<em>s</em>", 24.09, " ", 4.61)

ACT_df <- rbind(ACT_df, ACT_row1)
ACT_df <- rbind(ACT_df, ACT_row2)
ACT_df <- rbind(ACT_df, ACT_row3)
ACT_df <- rbind(ACT_df, ACT_row4)

# here again comes finally the output of the table with a standard command
knitr::kable(ACT_df, 
             booktabs = TRUE, 
             caption = "ACT Scores for Exercise 1 of Chapter 3",
             align = 'rrrr',
             escape = TRUE) # has to be added because of html in formated cells
```

Note that the data have be sorted by ACT score to make it easier to identify the median (in bold) and IQR.
